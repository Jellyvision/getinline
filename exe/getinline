#!/usr/bin/env ruby

$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)

require 'getinline'
require 'optparse'

options = {}

option_parser = OptionParser.new do |opts|
  executable_name = File.basename($PROGRAM_NAME)
  opts.banner = "
    getinline inlines CSS styles for HTML email development.

    Usage:
      #{executable_name} file_name
      #{executable_name} < file_name
      cat file_name | #{executable_name}
  "

  opts.on('-h', '--help', 'Print usage instructions') do
    options[:show_help] = true
  end
end

begin
  option_parser.parse!
  rescue OptionParser::InvalidOption => error
  puts "Getinline doesn't recognize that #{ error }"
  exit
  rescue OptionParser::AmbiguousOption => error
  puts "That's an #{ error}"
  exit
end

def transform (file_contents)
  transformer = Getinline::Transformer.new(file_contents)
  puts transformer.transform
end

if options[:show_help] == true
  puts option_parser.banner
  exit
end

if ARGV.length > 0
  ARGV.each do |filename|
    transform File.read(filename)
  end
else
  transform STDIN.read
end
